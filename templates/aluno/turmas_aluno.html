<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="/static/img/icon.svg" type="image/x-icon">
    <title>Aluno - Minhas Turmas</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/css/style.css">
</head>

<body id="topo">
    <div class="wrapper">
        <aside id="sidebar" class="shadow-lg">
            <div class="d-flex justify-content-center">
                <button class="toggle-btn d-flex flex-column align-items-center p-0 pt-3 w-100" type="button">
                    <img src="/static/img/DipePreta.svg" width="40px" alt="">
                </button>
            </div>
                        <ul class="sidebar-nav">
                <li class="sidebar-item">
                    <a href="/perfil" class="sidebar-link {% if request.url.path == '/perfil' %}active{% endif %}">
                        <i class="bi bi-house-door-fill"></i>
                        <span>Início</span>
                    </a>
                </li>
                <li class="sidebar-item mt-3">
                    <a href="/aluno/dados" class="sidebar-link {% if request.url.path == '/aluno/dados' %}active{% endif %}">
                        <i class="bi bi-person-fill"></i>
                        <span>Dados Pessoais</span>
                    </a>
                </li>
                <li class="sidebar-item mt-3">
                    <a href="/aluno/turmas" class="sidebar-link {% if request.url.path == '/aluno/turmas' or request.url.path.startswith('/aluno/turmas/') %}active{% endif %}">
                        <i class="bi bi-people-fill"></i>
                        <span>Minhas Turmas</span>
                    </a>
                </li>
                <li class="sidebar-item mt-3">
                    <a href="/aluno/provas" class="sidebar-link {% if request.url.path == '/aluno/provas' or request.url.path.startswith('/aluno/provas/') %}active{% endif %}">
                        <i class="bi bi-file-earmark-text-fill"></i>
                        <span>Provas das Turmas</span>
                    </a>
                </li>
                <li class="sidebar-item mt-3">
                    <a href="/aluno/formularios" class="sidebar-link {% if request.url.path == '/formularios' or request.url.path.startswith('/formularios/') %}active{% endif %}">
                        <i class="bi bi-clipboard2-fill"></i>
                        <span>Formulários</span>
                    </a>
                </li>
                <!-- Botão Sair -->
                <div class="sidebar-item mt-3">
                    <form action="/sair" method="post" style="display: inline;">
                        <button type="submit" class="sidebar-link w-100 text-start">
                            <i class="bi bi-door-open-fill"></i>
                            <span class="fw-bold">Sair</span>
                        </button>
                    </form>
                </div>
            </ul>
            <div class="sidebar-footer">
                <a href="#topo" class="sidebar-link">
                    <i class="bi bi-arrow-up"></i>
                    <span>Voltar ao topo</span>
                </a>
            </div>
        </aside>

        <div class="main bg-pattern p-4">

            <div class="content-wrapper">
                <!-- Alertas de Sucesso/Erro -->
                {% if sucesso %}
                <div class="alert alert-success alert-dismissible fade show" role="alert" id="alertSucesso">
                    <i class="bi bi-check-circle"></i> {{ sucesso }}
                    <button type="button" class="btn-close" onclick="fecharAlertaSucesso()" aria-label="Close"></button>
                </div>
                {% endif %}
                
                {% if erro %}
                <div class="alert alert-danger alert-dismissible fade show" role="alert" id="alertErro">
                    <i class="bi bi-exclamation-triangle"></i> {{ erro }}
                    <button type="button" class="btn-close" onclick="fecharAlertaErro()" aria-label="Close"></button>
                </div>
                {% endif %}

                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h2>Suas Turmas</h2>
                    <button type="button" class="btn btn-padrao text-light" onclick="abrirModalManual()">
                        <i class="bi bi-plus text-light"></i> Entrar em Turma
                    </button>
                </div>

                {% if turmas_aluno %}
                <div class="row">
                    {% for turma_aluno in turmas_aluno %}
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100">
                            <div class="card-header bg-padrao text-light">
                                <h5 class="mb-0">{{ turma_aluno.turma.nome }}</h5>
                            </div>
                            <div class="card-body">
                                <p class="card-text">
                                    <strong>Professor:</strong> {{ turma_aluno.turma.professor.nome }}<br>
                                    <strong>Campus:</strong> {{ turma_aluno.turma.campus.nome }}<br>
                                    <strong>Entrou em:</strong> {{ turma_aluno.data_entrada.strftime('%d/%m/%Y') }}
                                </p>
                            </div>
                            <div class="card-footer">
                                <div class="w-100">
                                    <a href="/aluno/provas?turma={{ turma_aluno.turma.id }}" class="btn btn-black btn-sm">
                                        <i class="bi bi-file-earmark-text text-light"></i> Ver Provas
                                    </a>
                                    <a href="/aluno/turma/{{ turma_aluno.turma.id }}/detalhes" class="btn btn-info btn-sm">
                                        <i class="bi bi-info-circle"></i> Detalhes
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-5 bg-branco borda rounded-3">
                    <i class="bi bi-people display-3 c-padrao"></i>
                    <h3 class="text-muted mt-3">Você não está em nenhuma turma</h3>
                    <p class="text-muted">Entre em uma turma usando o código fornecido pelo seu professor.</p>
                    <button type="button" class="btn btn-padrao btn-lg text-light mt-2" onclick="abrirModalManual()">
                        <i class="bi bi-plus-circle text-light"></i> Entrar em Turma
                    </button>
                </div>
                {% endif %}

                <!-- Instruções -->
                <div class="card mt-4">
                    <div class="card-header">
                        <h5 class="mb-0">Como entrar em uma turma</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>1. Obtenha o código</h6>
                                <p>Peça ao seu professor o código da turma (6 caracteres).</p>
                                
                                <h6>2. Clique em "Entrar em Turma"</h6>
                                <p>Use o botão acima para acessar a página de entrada.</p>
                                
                                <h6>3. Digite o código</h6>
                                <p>Insira o código fornecido pelo professor e confirme.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Entrar em Turma -->
    <div class="modal fade" id="entrarTurmaModal" tabindex="-1" aria-labelledby="entrarTurmaModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-padrao text-light">
                    <h5 class="modal-title" id="entrarTurmaModalLabel">
                        Entrar em Turma
                    </h5>
                    <button type="button" class="btn-close" onclick="fecharModal()" aria-label="Close"></button>
                </div>
                <form method="post" action="/aluno/turmas/entrar">
                    <div class="modal-body">
                        <div class="text-center mb-4">
                            <i class="bi bi-people display-1 text-padrao"></i>
                            <h4 class="mt-3">Entre em uma turma</h4>
                            <p class="text-muted">Digite o código da turma fornecido pelo seu professor</p>
                        </div>
                        
                        <div class="mb-3">
                            <label for="codigo" class="form-label">
                                <i class="bi bi-key"></i> Código da Turma
                            </label>
                            <input type="text" class="form-control form-control-lg text-center" 
                                   id="codigo" name="codigo" placeholder="Ex: ABC123" 
                                   maxlength="6" required style="font-size: 1.2rem; letter-spacing: 0.2em;">
                            <div class="form-text">
                                <i class="bi bi-info-circle"></i> 
                                O código deve ter exatamente 6 caracteres
                            </div>
                        </div>
                        
                        <div class="alert alert-info">
                            <i class="bi bi-lightbulb"></i>
                            <strong>Dica:</strong> O código da turma é fornecido pelo seu professor e contém 6 caracteres alfanuméricos.
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="fecharModal()">
                            <i class="bi bi-x-circle text-light"></i> Cancelar
                        </button>
                        <button type="submit" class="btn btn-padrao text-light">
                            <i class="bi bi-check text-light"></i> Entrar na Turma
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeoT1M7WU2s484xIq7t8/84EdhRxl2bc3SB8XntG7FwUPFGZ"
        crossorigin="anonymous"></script>
    <script src="/static/js/menu.js"></script>
    
    <script>
        // Função para abrir modal manualmente
        function abrirModalManual() {
            const modalElement = document.getElementById('entrarTurmaModal');
            if (typeof bootstrap !== 'undefined') {
                const modal = new bootstrap.Modal(modalElement);
                modal.show();
            } else {
                // Fallback: mostrar modal via CSS
                modalElement.style.display = 'block';
                modalElement.classList.add('show');
                document.body.classList.add('modal-open');
            }
        }
        
        // Função para fechar modal
        function fecharModal() {
            const modalElement = document.getElementById('entrarTurmaModal');
            if (typeof bootstrap !== 'undefined') {
                const modal = bootstrap.Modal.getInstance(modalElement);
                if (modal) {
                    modal.hide();
                } else {
                    const newModal = new bootstrap.Modal(modalElement);
                    newModal.hide();
                }
            } else {
                // Fallback: esconder modal via CSS
                modalElement.style.display = 'none';
                modalElement.classList.remove('show');
                document.body.classList.remove('modal-open');
            }
        }
        
        // Auto-focus no campo de código quando o modal abrir
        document.getElementById('entrarTurmaModal').addEventListener('shown.bs.modal', function () {
            document.getElementById('codigo').focus();
        });
        
        // Converter para maiúsculas automaticamente
        document.getElementById('codigo').addEventListener('input', function(e) {
            e.target.value = e.target.value.toUpperCase();
        });
        
        // Variáveis globais para armazenar os timers dos alertas
        let timerAlertaErro = null;
        let timerAlertaSucesso = null;
        
        // Função para fechar alerta de erro
        function fecharAlertaErro() {
            const alertError = document.getElementById('alertErro');
            if (alertError) {
                // Cancelar timer automático se existir
                if (timerAlertaErro) {
                    clearTimeout(timerAlertaErro);
                    timerAlertaErro = null;
                }
                // Fechar alerta com animação
                alertError.style.transition = 'opacity 0.5s ease-out';
                alertError.style.opacity = '0';
                setTimeout(function() {
                    alertError.remove();
                }, 500);
            }
        }
        
        // Função para fechar alerta de sucesso
        function fecharAlertaSucesso() {
            const alertSucesso = document.getElementById('alertSucesso');
            if (alertSucesso) {
                // Cancelar timer automático se existir
                if (timerAlertaSucesso) {
                    clearTimeout(timerAlertaSucesso);
                    timerAlertaSucesso = null;
                }
                // Fechar alerta com animação
                alertSucesso.style.transition = 'opacity 0.5s ease-out';
                alertSucesso.style.opacity = '0';
                setTimeout(function() {
                    alertSucesso.remove();
                }, 500);
            }
        }
        
        // Auto-remover alertas em 2 segundos
        document.addEventListener('DOMContentLoaded', function() {
            // Alerta de erro
            const alertError = document.getElementById('alertErro');
            if (alertError) {
                timerAlertaErro = setTimeout(function() {
                    alertError.style.transition = 'opacity 0.5s ease-out';
                    alertError.style.opacity = '0';
                    setTimeout(function() {
                        alertError.remove();
                    }, 500);
                }, 2000);
            }
            
            // Alerta de sucesso
            const alertSucesso = document.getElementById('alertSucesso');
            if (alertSucesso) {
                timerAlertaSucesso = setTimeout(function() {
                    alertSucesso.style.transition = 'opacity 0.5s ease-out';
                    alertSucesso.style.opacity = '0';
                    setTimeout(function() {
                        alertSucesso.remove();
                    }, 500);
                }, 2000);
            }
        });
    </script>
    
</body>

</html>

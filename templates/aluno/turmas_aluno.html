<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="/static/img/icon.svg" type="image/x-icon">
    <title>Aluno - Minhas Turmas</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/css/style.css">
</head>

<body id="topo">
    <div class="wrapper">
        <div id="sidebar-wrapper" class="d-flex expand">
            <aside id="sidebar" class="expand shadow-lg">
                <div class="sidebar-logo-container">
                    <button class="toggle-btn sidebar-link" type="button">
                        <img src="/static/img/DipePreta.svg" width="24px" alt="DIPE" class="sidebar-logo-icon">
                        <span class="f-exo fs-6 fw-black">DIPE</span>
                    </button>
                </div>
                <ul class="sidebar-nav">
                    <li class="sidebar-item">
                        <a href="/perfil" class="sidebar-link {% if request.url.path == '/perfil' %}active{% endif %}">
                            <i class="bi bi-house-door-fill"></i>
                            <span>Início</span>
                        </a>
                    </li>
                    <li class="sidebar-item mt-3">
                        <a href="/aluno/dados"
                            class="sidebar-link {% if request.url.path == '/aluno/dados' %}active{% endif %}">
                            <i class="bi bi-person-fill"></i>
                            <span>Dados Pessoais</span>
                        </a>
                    </li>
                    <li class="sidebar-item mt-3">
                        <a href="/aluno/turmas"
                            class="sidebar-link {% if request.url.path == '/aluno/turmas' or request.url.path.startswith('/aluno/turmas/') %}active{% endif %}">
                            <i class="bi bi-people-fill"></i>
                            <span>Minhas Turmas</span>
                        </a>
                    </li>
                    <li class="sidebar-item mt-3">
                        <a href="/aluno/provas"
                            class="sidebar-link {% if request.url.path == '/aluno/provas' or request.url.path.startswith('/aluno/provas/') %}active{% endif %}">
                            <i class="bi bi-file-earmark-text-fill"></i>
                            <span>Provas das Turmas</span>
                        </a>
                    </li>
                    <li class="sidebar-item mt-3">
                        <a href="/aluno/formularios"
                            class="sidebar-link {% if request.url.path == '/formularios' or request.url.path.startswith('/formularios/') %}active{% endif %}">
                            <i class="bi bi-clipboard2-fill"></i>
                            <span>Formulários</span>
                        </a>
                    </li>
                    <!-- Botão Sair -->
                    <div class="sidebar-item mt-3">
                        <form action="/sair" method="post" style="display: inline;">
                            <button type="submit" class="sidebar-link w-100 text-start">
                                <i class="bi bi-door-open-fill"></i>
                                <span class="fw-bold">Sair</span>
                            </button>
                        </form>
                    </div>
                </ul>
                <div class="sidebar-footer">
                    <a href="#topo" class="sidebar-link">
                        <i class="bi bi-arrow-up"></i>
                        <span>Voltar ao topo</span>
                    </a>
                </div>
            </aside>

            <div id="toggle-bar" class="d-flex align-items-center justify-content-center shadow-lg bg-gradiente cursor-pointer">
                <i class="bi bi-chevron-right toggle-icon c-black"></i>
            </div>
        </div>

        <div class="main bg-pattern p-4">

            <div class="content-wrapper">
                <!-- Alertas de Sucesso/Erro -->
                {% if sucesso %}
                <div class="alert alert-success alert-dismissible fade show" role="alert" id="alertSucesso">
                    <i class="bi bi-check-circle"></i> {{ sucesso }}
                    <button type="button" class="btn-close" onclick="fecharAlertaSucesso()" aria-label="Close"></button>
                </div>
                {% endif %}
                
                {% if erro %}
                <div class="alert alert-danger alert-dismissible fade show" role="alert" id="alertErro">
                    <i class="bi bi-exclamation-triangle"></i> {{ erro }}
                    <button type="button" class="btn-close" onclick="fecharAlertaErro()" aria-label="Close"></button>
                </div>
                {% endif %}

                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h2>Suas Turmas</h2>
                    <button type="button" class="btn btn-padrao text-light" onclick="abrirModalManual()">
                        <i class="bi bi-plus text-light"></i> Entrar em Turma
                    </button>
                </div>

                {% set paleta = [
                    '#B93C30',  
                    '#264653',  
                    '#1D7065',  
                    '#A45D1D',  
                    '#6D3B68',  
                    '#8C2F39',  
                    '#3D5A80'   
                ] %}

                {% if turmas_aluno %}
                <div class="row">
                    {% for turma_aluno in turmas_aluno %}
                    {% set turma = turma_aluno.turma %}
                    {% set cor_card = paleta[turma_aluno.id % paleta|length] %}
                    <div class="col-md-6 col-lg-4 mb-4 turma-card" data-status="">
                        <div class="card h-100 border-0 shadow-sm overflow-hidden rounded-3">
                            
                            <div class="card-header border-0 p-4 position-relative" style="background-color: {{ cor_card }}; color: white; padding-bottom: 3rem !important;">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h5 class="fw-bold mb-1 text-light">{{ turma_aluno.turma.nome }}</h5>
                                        <p class="mb-0 opacity-75 text-light">{{ turma_aluno.turma.professor.nome }}</p>
                                    </div>
                                </div>
                            </div>
                    
                            <div class="card-body position-relative pt-0 bg-white">
                                
                                <div class="d-flex align-items-start">
                                    <div class="me-3 position-relative" style="margin-top: -40px;">
                                        <img src="{{ turma.imagem_professor or '/static/img/user.jpg' }}" 
                                             alt="{{ turma.professor.nome }}" 
                                             class="rounded-circle border border-4 border-white shadow-sm" 
                                             width="80" 
                                             height="80" 
                                             style="object-fit: cover; background-color: white;">
                                    </div>
                                    
                                    <div class="flex-grow-1 mt-2">
                                        <div class="d-flex flex-column gap-1 text-muted small">
                                            <div class="d-flex align-items-center">
                                                <i class="bi bi-calendar-event-fill me-2"></i> 
                                                <span>Entrou em: {{ turma_aluno.data_entrada.strftime('%d/%m/%Y') }}</span>
                                            </div>
                                            <div class="d-flex align-items-center">
                                                <i class="bi bi-geo-alt-fill me-2"></i> 
                                                <span>{{ turma_aluno.turma.campus.nome }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                    
                            <div class="card-footer bg-white border-top py-3">
                                <div class="row text-center g-0 divide-x">
                                    
                                    <div class="col-4 border-end">
                                        <h5 class="fw-bold mb-0 text-dark">{{ turma.aluno_turmas|length }}</h5>
                                        <small class="text-muted fs-7">Matriculados</small>
                                    </div>
                    
                                    <div class="col-4 border-end">
                                        <a href="/aluno/turma/{{ turma_aluno.turma.id }}/detalhes" class="text-decoration-none text-dark d-block">
                                            <i class="bi bi-eye-fill fs-5 c-padrao"></i>
                                            <div class="text-muted fs-7 c-padrao">Detalhes</div>
                                        </a>
                                    </div>
                    
                                    <div class="col-4">
                                        <a href="/aluno/provas?turma={{ turma_aluno.turma.id }}" class="text-decoration-none text-dark d-block">
                                            <i class="bi bi-file-text-fill fs-5 c-padrao"></i>
                                            <div class="text-muted fs-7 c-padrao">Provas</div>
                                        </a>
                                    </div>
                    
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-5 bg-branco borda rounded-3">
                    <i class="bi bi-people display-3 c-padrao"></i>
                    <h3 class="text-muted mt-3">Você não está em nenhuma turma</h3>
                    <p class="text-muted">Entre em uma turma usando o código fornecido pelo seu professor.</p>
                    <button type="button" class="btn btn-padrao btn-lg text-light mt-2" onclick="abrirModalManual()">
                        <i class="bi bi-plus-circle text-light"></i> Entrar em Turma
                    </button>
                </div>
                {% endif %}

                <!-- Instruções -->
                <div class="card mt-4">
                    <div class="card-header">
                        <h5 class="mb-0">Como entrar em uma turma</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>1. Obtenha o código</h6>
                                <p>Peça ao seu professor o código da turma (6 caracteres).</p>
                                
                                <h6>2. Clique em "Entrar em Turma"</h6>
                                <p>Use o botão acima para acessar a página de entrada.</p>
                                
                                <h6>3. Digite o código</h6>
                                <p>Insira o código fornecido pelo professor e confirme.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Entrar em Turma -->
    <div class="modal fade" id="entrarTurmaModal" tabindex="-1" aria-labelledby="entrarTurmaModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-padrao text-light">
                    <h5 class="modal-title" id="entrarTurmaModalLabel">
                        Entrar em Turma
                    </h5>
                    <button type="button" class="btn-close" onclick="fecharModal()" aria-label="Close"></button>
                </div>
                <form method="post" action="/aluno/turmas/entrar">
                    <div class="modal-body">
                        <div class="text-center mb-4">
                            <i class="bi bi-people display-1 text-padrao"></i>
                            <h4 class="mt-3">Entre em uma turma</h4>
                            <p class="text-muted">Digite o código da turma fornecido pelo seu professor</p>
                        </div>
                        
                        <div class="mb-3">
                            <label for="codigo" class="form-label">
                                <i class="bi bi-key"></i> Código da Turma
                            </label>
                            <input type="text" class="form-control form-control-lg text-center" 
                                   id="codigo" name="codigo" placeholder="Ex: ABC123" 
                                   maxlength="6" required style="font-size: 1.2rem; letter-spacing: 0.2em;">
                            <div class="form-text">
                                <i class="bi bi-info-circle"></i> 
                                O código deve ter exatamente 6 caracteres
                            </div>
                        </div>
                        
                        <div class="alert alert-info">
                            <i class="bi bi-lightbulb"></i>
                            <strong>Dica:</strong> O código da turma é fornecido pelo seu professor e contém 6 caracteres alfanuméricos.
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="fecharModal()">
                            <i class="bi bi-x-circle text-light"></i> Cancelar
                        </button>
                        <button type="submit" class="btn btn-padrao text-light">
                            <i class="bi bi-check text-light"></i> Entrar na Turma
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeoT1M7WU2s484xIq7t8/84EdhRxl2bc3SB8XntG7FwUPFGZ"
        crossorigin="anonymous"></script>
    <script src="/static/js/menu.js"></script>
    
    <script>
        // Função para abrir modal manualmente
        function abrirModalManual() {
            const modalElement = document.getElementById('entrarTurmaModal');
            if (typeof bootstrap !== 'undefined') {
                const modal = new bootstrap.Modal(modalElement);
                modal.show();
            } else {
                // Fallback: mostrar modal via CSS
                modalElement.style.display = 'block';
                modalElement.classList.add('show');
                document.body.classList.add('modal-open');
            }
        }
        
        // Função para fechar modal
        function fecharModal() {
            const modalElement = document.getElementById('entrarTurmaModal');
            if (typeof bootstrap !== 'undefined') {
                const modal = bootstrap.Modal.getInstance(modalElement);
                if (modal) {
                    modal.hide();
                } else {
                    const newModal = new bootstrap.Modal(modalElement);
                    newModal.hide();
                }
            } else {
                // Fallback: esconder modal via CSS
                modalElement.style.display = 'none';
                modalElement.classList.remove('show');
                document.body.classList.remove('modal-open');
            }
        }
        
        // Auto-focus no campo de código quando o modal abrir
        document.getElementById('entrarTurmaModal').addEventListener('shown.bs.modal', function () {
            document.getElementById('codigo').focus();
        });
        
        // Converter para maiúsculas automaticamente
        document.getElementById('codigo').addEventListener('input', function(e) {
            e.target.value = e.target.value.toUpperCase();
        });
        
        // Variáveis globais para armazenar os timers dos alertas
        let timerAlertaErro = null;
        let timerAlertaSucesso = null;
        
        // Função para fechar alerta de erro
        function fecharAlertaErro() {
            const alertError = document.getElementById('alertErro');
            if (alertError) {
                // Cancelar timer automático se existir
                if (timerAlertaErro) {
                    clearTimeout(timerAlertaErro);
                    timerAlertaErro = null;
                }
                // Fechar alerta com animação
                alertError.style.transition = 'opacity 0.5s ease-out';
                alertError.style.opacity = '0';
                setTimeout(function() {
                    alertError.remove();
                }, 500);
            }
        }
        
        // Função para fechar alerta de sucesso
        function fecharAlertaSucesso() {
            const alertSucesso = document.getElementById('alertSucesso');
            if (alertSucesso) {
                // Cancelar timer automático se existir
                if (timerAlertaSucesso) {
                    clearTimeout(timerAlertaSucesso);
                    timerAlertaSucesso = null;
                }
                // Fechar alerta com animação
                alertSucesso.style.transition = 'opacity 0.5s ease-out';
                alertSucesso.style.opacity = '0';
                setTimeout(function() {
                    alertSucesso.remove();
                }, 500);
            }
        }
        
        // Auto-remover alertas em 2 segundos
        document.addEventListener('DOMContentLoaded', function() {
            // Alerta de erro
            const alertError = document.getElementById('alertErro');
            if (alertError) {
                timerAlertaErro = setTimeout(function() {
                    alertError.style.transition = 'opacity 0.5s ease-out';
                    alertError.style.opacity = '0';
                    setTimeout(function() {
                        alertError.remove();
                    }, 500);
                }, 2000);
            }
            
            // Alerta de sucesso
            const alertSucesso = document.getElementById('alertSucesso');
            if (alertSucesso) {
                timerAlertaSucesso = setTimeout(function() {
                    alertSucesso.style.transition = 'opacity 0.5s ease-out';
                    alertSucesso.style.opacity = '0';
                    setTimeout(function() {
                        alertSucesso.remove();
                    }, 500);
                }, 2000);
            }
        });
    </script>
    
</body>

</html>

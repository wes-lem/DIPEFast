<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="/static/img/icon.svg" type="image/x-icon">
    <title>Gestor - Gerenciar Usuários</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/css/style.css">
</head>

<body id="topo">
    <div class="wrapper">
        <aside id="sidebar" class="shadow-lg">
            <div class="d-flex justify-content-center">
                <button class="toggle-btn d-flex flex-column align-items-center p-0 pt-3 w-100" type="button">
                    <img src="/static/img/DipePreta.svg" width="40px" alt="">
                </button>
            </div>
            <ul class="sidebar-nav">
                <li class="sidebar-item">
                    <a href="/gestor/dashboard" class="sidebar-link {% if request.url.path == '/gestor/dashboard' %}active{% endif %}">
                        <i class="bi bi-house-door-fill"></i>
                        <span>Início</span>
                    </a>
                </li>
                <li class="sidebar-item mt-3">
                    <a href="/alunos" class="sidebar-link {% if request.url.path == '/alunos' %}active{% endif %}">
                        <i class="bi bi-people-fill"></i>
                        <span>Alunos</span>
                    </a>
                </li>
                <li class="sidebar-item mt-3">
                    <a href="/gestor/professores" class="sidebar-link {% if request.url.path == '/gestor/professores' or request.url.path.startswith('/gestor/professores/') %}active{% endif %}">
                        <i class="bi bi-person-badge-fill"></i>
                        <span>Professores</span>
                    </a>
                </li>
                <li class="sidebar-item mt-3">
                    <a href="/gestor/turmas" class="sidebar-link {% if request.url.path == '/gestor/turmas' or request.url.path.startswith('/gestor/turma/') %}active{% endif %}">
                        <i class="bi bi-collection-fill"></i>
                        <span>Turmas</span>
                    </a>
                </li>
                <li class="sidebar-item mt-3">
                    <a href="/gestor/provas-professores" class="sidebar-link {% if request.url.path == '/gestor/provas-professores' or request.url.path.startswith('/gestor/prova/') %}active{% endif %}">
                        <i class="bi bi-file-earmark-check-fill"></i>
                        <span>Provas dos Professores</span>
                    </a>
                </li>
                <li class="sidebar-item mt-3">
                    <a href="/gestor/formularios" class="sidebar-link {% if request.url.path == '/gestor/formularios' %}active{% endif %}">
                        <i class="bi bi-clipboard2-fill"></i>
                        <span>Formulários</span>
                    </a>
                </li>
                <li class="sidebar-item mt-3">
                    <a href="/gestor/gerenciar-usuarios" class="sidebar-link {% if request.url.path == '/gestor/gerenciar-usuarios' %}active{% endif %}">
                        <i class="bi bi-people-fill"></i>
                        <span>Gerenciar Usuários</span>
                    </a>
                </li>
                <div class="sidebar-item mt-3">
                    <form action="/sair" method="post" style="display: inline;">
                        <button type="submit" class="sidebar-link w-100 text-start">
                            <i class="bi bi-door-open-fill"></i>
                            <span class="fw-bold">Sair</span>
                        </button>
                    </form>
                </div>
            </ul>
            <div class="sidebar-footer">
                <a href="#topo" class="sidebar-link">
                    <i class="bi bi-arrow-up"></i>
                    <span>Voltar ao topo</span>
                </a>
            </div>
        </aside>

        <div class="main bg-pattern p-4">
            <div class="content-wrapper">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Gerenciar Usuários</h2>
                    <div>
                        <button type="button" class="btn btn-padrao text-light" onclick="abrirModal('modalCadastrarAluno')">
                            <i class="bi bi-person-plus text-light"></i> Cadastrar Aluno
                        </button>
                        <button type="button" class="btn btn-padrao text-light" onclick="abrirModal('modalCadastrarProfessor')">
                            <i class="bi bi-person-badge text-light"></i> Cadastrar Professor
                        </button>
                        <button type="button" class="btn btn-padrao text-light" onclick="abrirModal('modalCadastrarGestor')">
                            <i class="bi bi-person-gear text-light"></i> Cadastrar Gestor
                        </button>
                    </div>
                </div>

                <!-- Estatísticas -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title text-primary">{{ total_alunos }}</h5>
                                <p class="card-text">Total de Alunos</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title text-success">{{ total_professores }}</h5>
                                <p class="card-text">Total de Professores</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title text-info">{{ total_gestores }}</h5>
                                <p class="card-text">Total de Gestores</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title text-warning">{{ total_usuarios }}</h5>
                                <p class="card-text">Total de Usuários</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Abas -->
                <ul class="nav nav-tabs" id="usuariosTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="alunos-tab" data-bs-toggle="tab" data-bs-target="#alunos" type="button" role="tab">
                            <i class="bi bi-people"></i> Alunos ({{ total_alunos }})
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="professores-tab" data-bs-toggle="tab" data-bs-target="#professores" type="button" role="tab">
                            <i class="bi bi-person-badge"></i> Professores ({{ total_professores }})
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="gestores-tab" data-bs-toggle="tab" data-bs-target="#gestores" type="button" role="tab">
                            <i class="bi bi-person-gear"></i> Gestores ({{ total_gestores }})
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="campus-tab" data-bs-toggle="tab" data-bs-target="#campus" type="button" role="tab">
                            <i class="bi bi-building"></i> Campus ({{ total_campus }})
                        </button>
                    </li>
                </ul>

                <!-- Conteúdo das Abas -->
                <div class="tab-content" id="usuariosTabsContent">
                    <!-- Aba Alunos -->
                    <div class="tab-pane fade show active" id="alunos" role="tabpanel">
                        <div class="card mt-3">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Lista de Alunos</h5>
                                <div class="d-flex gap-2">
                                    <input type="text" class="form-control" id="buscarAlunos" placeholder="Buscar aluno..." style="width: 200px;">
                                    <select class="form-select" id="filtroCursoAlunos" style="width: 150px;">
                                        <option value="">Todos os cursos</option>
                                        <option value="Redes de Computadores">Redes de Computadores</option>
                                        <option value="Agropecuária">Agropecuária</option>
                                        <option value="Partiu IF">Partiu IF</option>
                                    </select>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Foto</th>
                                                <th>Nome</th>
                                                <th>Email</th>
                                                <th>Curso</th>
                                                <th>Ano</th>
                                                <th>Data Cadastro</th>
                                                <th>Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tabelaAlunos">
                                            {% for aluno in alunos %}
                                            <tr>
                                                <td>
                                                    <img src="{{ aluno.imagem or '/static/img/user.jpg' }}" 
                                                         alt="Aluno" class="rounded-circle" width="40" height="40">
                                                </td>
                                                <td>{{ aluno.nome }}</td>
                                                <td>{{ aluno.usuario.email }}</td>
                                                <td>{{ aluno.curso }}</td>
                                                <td>{{ aluno.ano }}</td>
                                                <td>-</td>
                                                <td>
                                                    <div class="d-flex gap-2">
                                                          <button type="button" class="btn btn-sm btn-dark" 
                                                                   onclick="verDetalhesAluno({{ aluno.idAluno }})">
                                                              <i class="bi bi-eye text-light"></i>
                                                          </button>
                                                        <button type="button" class="btn btn-sm btn-warning" 
                                                                onclick="editarAluno({{ aluno.idAluno }})">
                                                            <i class="bi bi-pencil"></i>
                                                        </button>
                                                        <button type="button" class="btn btn-sm btn-danger" 
                                                                onclick="excluirAluno({{ aluno.idAluno }}, '{{ aluno.nome }}')">
                                                            <i class="bi bi-trash text-light"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Aba Professores -->
                    <div class="tab-pane fade" id="professores" role="tabpanel">
                        <div class="card mt-3">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Lista de Professores</h5>
                                <div class="d-flex gap-2">
                                    <input type="text" class="form-control" id="buscarProfessores" placeholder="Buscar professor..." style="width: 200px;">
                                    <select class="form-select" id="filtroCampusProfessores" style="width: 150px;">
                                        <option value="">Todos os campus</option>
                                        {% for campus in campus_list %}
                                        <option value="{{ campus.nome }}">{{ campus.nome }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Foto</th>
                                                <th>Nome</th>
                                                <th>Email</th>
                                                <th>Campus</th>
                                                <th>Data Cadastro</th>
                                                <th>Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tabelaProfessores">
                                            {% for professor in professores %}
                                            <tr>
                                                <td>
                                                    <img src="{{ professor.imagem or '/static/img/user.jpg' }}" 
                                                         alt="Professor" class="rounded-circle" width="40" height="40">
                                                </td>
                                                <td>{{ professor.nome }}</td>
                                                <td>{{ professor.usuario.email }}</td>
                                                <td>{{ professor.campus.nome }}</td>
                                                <td>{{ professor.data_cadastro.strftime('%d/%m/%Y') }}</td>
                                                <td>
                                                    <div class="d-flex gap-2">
                                                          <button type="button" class="btn btn-sm btn-dark" 
                                                                   onclick="verDetalhesProfessor({{ professor.id }})">
                                                              <i class="bi bi-eye text-light"></i>
                                                          </button>
                                                        <button type="button" class="btn btn-sm btn-warning" 
                                                                onclick="editarProfessor({{ professor.id }})">
                                                            <i class="bi bi-pencil"></i>
                                                        </button>
                                                        <button type="button" class="btn btn-sm btn-danger" 
                                                                onclick="excluirProfessor({{ professor.id }}, '{{ professor.nome }}')">
                                                            <i class="bi bi-trash text-light"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Aba Gestores -->
                    <div class="tab-pane fade" id="gestores" role="tabpanel">
                        <div class="card mt-3">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Lista de Gestores</h5>
                                <div class="d-flex gap-2">
                                    <input type="text" class="form-control" id="buscarGestores" placeholder="Buscar gestor..." style="width: 200px;">
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Foto</th>
                                                <th>Nome</th>
                                                <th>Email</th>
                                                <th>Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tabelaGestores">
                                            {% for gestor in gestores %}
                                            <tr>
                                                <td>
                                                    <img src="{{ gestor.imagem or '/static/img/user.jpg' }}" 
                                                         alt="Gestor" class="rounded-circle" width="40" height="40">
                                                </td>
                                                <td>{{ gestor.nome }}</td>
                                                <td>{{ gestor.usuario.email }}</td>
                                                <td>
                                                    <div class="d-flex gap-2">
                                                          <button type="button" class="btn btn-sm btn-dark" 
                                                                   onclick="verDetalhesGestor({{ gestor.id }})">
                                                              <i class="bi bi-eye text-light"></i>
                                                          </button>
                                                        <button type="button" class="btn btn-sm btn-warning" 
                                                                onclick="editarGestor({{ gestor.id }})">
                                                            <i class="bi bi-pencil"></i>
                                                        </button>
                                                        <button type="button" class="btn btn-sm btn-danger" 
                                                                onclick="excluirGestor({{ gestor.id }}, '{{ gestor.nome }}')">
                                                            <i class="bi bi-trash text-light"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Aba Campus -->
                    <div class="tab-pane fade" id="campus" role="tabpanel">
                        <div class="card mt-3">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Lista de Campus</h5>
                                <div class="d-flex gap-2">
                                    <input type="text" class="form-control" id="buscarCampus" placeholder="Buscar campus..." style="width: 200px;">
                                    <button type="button" class="btn btn-padrao text-light" onclick="abrirModal('modalCadastrarCampus')">
                                        <i class="bi bi-building-add text-light"></i> Novo Campus
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Nome</th>
                                                <th>Endereço</th>
                                                <th>Status</th>
                                                <th>Professores</th>
                                                <th>Turmas</th>
                                                <th>Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tabelaCampus">
                                            {% for campus in campus_list %}
                                            <tr>
                                                <td>{{ campus.nome }}</td>
                                                <td>{{ campus.endereco or '-' }}</td>
                                                <td>
                                                    <span class="badge {% if campus.ativo %}bg-success{% else %}bg-secondary{% endif %}">
                                                        {% if campus.ativo %}Ativo{% else %}Inativo{% endif %}
                                                    </span>
                                                </td>
                                                <td>{{ campus.professores|length }}</td>
                                                <td>{{ campus.turmas|length }}</td>
                                                <td>
                                                    <div>
                                                         <button type="button" class="btn btn-sm btn-warning" 
                                                                 onclick="editarCampus({{ campus.id }}, '{{ campus.nome }}', '{{ campus.endereco or '' }}', {{ campus.ativo|lower }})">
                                                             <i class="bi bi-pencil"></i>
                                                         </button>
                                                        <button type="button" class="btn btn-sm btn-danger" 
                                                                onclick="excluirCampus({{ campus.id }}, '{{ campus.nome }}')">
                                                            <i class="bi bi-trash text-light"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Cadastrar Aluno -->
    <div class="modal fade" id="modalCadastrarAluno" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Cadastrar Novo Aluno</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form action="/gestor/cadastrar-aluno" method="post" enctype="multipart/form-data">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="nomeAluno" class="form-label">Nome Completo</label>
                                    <input type="text" class="form-control" id="nomeAluno" name="nome" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="emailAluno" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="emailAluno" name="email" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="senhaAluno" class="form-label">Senha</label>
                                    <input type="password" class="form-control" id="senhaAluno" name="senha" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="cursoAluno" class="form-label">Curso</label>
                                    <select class="form-select" id="cursoAluno" name="curso" required>
                                        <option value="">Selecione o curso</option>
                                        <option value="Redes de Computadores">Redes de Computadores</option>
                                        <option value="Agropecuária">Agropecuária</option>
                                        <option value="Partiu IF">Partiu IF</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="anoAluno" class="form-label">Ano</label>
                                    <input type="number" class="form-control" id="anoAluno" name="ano" min="1" max="4" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="imagemAluno" class="form-label">Foto</label>
                                    <input type="file" class="form-control" id="imagemAluno" name="imagem" accept="image/*">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="fecharModal('modalCadastrarAluno')">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Cadastrar Aluno</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Cadastrar Professor -->
    <div class="modal fade" id="modalCadastrarProfessor" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Cadastrar Novo Professor</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form action="/gestor/cadastrar-professor" method="post" enctype="multipart/form-data">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="nomeProfessor" class="form-label">Nome Completo</label>
                                    <input type="text" class="form-control" id="nomeProfessor" name="nome" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="emailProfessor" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="emailProfessor" name="email" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="senhaProfessor" class="form-label">Senha</label>
                                    <input type="password" class="form-control" id="senhaProfessor" name="senha" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="campusProfessor" class="form-label">Campus</label>
                                    <select class="form-select" id="campusProfessor" name="campus_id" required>
                                        <option value="">Selecione o campus</option>
                                        {% for campus in campus_list %}
                                        <option value="{{ campus.id }}">{{ campus.nome }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="imagemProfessor" class="form-label">Foto</label>
                                    <input type="file" class="form-control" id="imagemProfessor" name="imagem" accept="image/*">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="fecharModal('modalCadastrarProfessor')">Cancelar</button>
                        <button type="submit" class="btn btn-success">Cadastrar Professor</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Cadastrar Gestor -->
    <div class="modal fade" id="modalCadastrarGestor" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Cadastrar Novo Gestor</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form action="/gestor/cadastrar-gestor" method="post" enctype="multipart/form-data">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="nomeGestor" class="form-label">Nome Completo</label>
                                    <input type="text" class="form-control" id="nomeGestor" name="nome" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="emailGestor" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="emailGestor" name="email" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="senhaGestor" class="form-label">Senha</label>
                                    <input type="password" class="form-control" id="senhaGestor" name="senha" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="imagemGestor" class="form-label">Foto</label>
                                    <input type="file" class="form-control" id="imagemGestor" name="imagem" accept="image/*">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="fecharModal('modalCadastrarGestor')">Cancelar</button>
                        <button type="submit" class="btn btn-info">Cadastrar Gestor</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Editar Aluno -->
    <div class="modal fade" id="modalEditarAluno" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Editar Aluno</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="formEditarAluno" method="post" enctype="multipart/form-data">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editNomeAluno" class="form-label">Nome Completo</label>
                                    <input type="text" class="form-control" id="editNomeAluno" name="nome" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editEmailAluno" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="editEmailAluno" name="email" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editSenhaAluno" class="form-label">Nova Senha (deixe em branco para manter a atual)</label>
                                    <input type="password" class="form-control" id="editSenhaAluno" name="senha">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editCursoAluno" class="form-label">Curso</label>
                                    <select class="form-select" id="editCursoAluno" name="curso" required>
                                        <option value="">Selecione o curso</option>
                                        <option value="Redes de Computadores">Redes de Computadores</option>
                                        <option value="Agropecuária">Agropecuária</option>
                                        <option value="Partiu IF">Partiu IF</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editAnoAluno" class="form-label">Ano</label>
                                    <input type="number" class="form-control" id="editAnoAluno" name="ano" min="1" max="4" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editImagemAluno" class="form-label">Nova Foto</label>
                                    <input type="file" class="form-control" id="editImagemAluno" name="imagem" accept="image/*">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="fecharModal('modalEditarAluno')">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Salvar Alterações</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Cadastrar Campus -->
    <div class="modal fade" id="modalCadastrarCampus" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Cadastrar Campus</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form method="post" action="/gestor/cadastrar-campus">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="nomeCampus" class="form-label">Nome do Campus</label>
                            <input type="text" class="form-control" id="nomeCampus" name="nome" required>
                        </div>
                        <div class="mb-3">
                            <label for="enderecoCampus" class="form-label">Endereço</label>
                            <textarea class="form-control" id="enderecoCampus" name="endereco" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="fecharModal('modalCadastrarCampus')">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Cadastrar Campus</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Editar Campus -->
    <div class="modal fade" id="modalEditarCampus" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Editar Campus</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="formEditarCampus" method="post">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="editNomeCampus" class="form-label">Nome do Campus</label>
                            <input type="text" class="form-control" id="editNomeCampus" name="nome" required>
                        </div>
                        <div class="mb-3">
                            <label for="editEnderecoCampus" class="form-label">Endereço</label>
                            <textarea class="form-control" id="editEnderecoCampus" name="endereco" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editAtivoCampus" name="ativo" value="true">
                                <label class="form-check-label" for="editAtivoCampus">
                                    Campus Ativo
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="fecharModal('modalEditarCampus')">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Salvar Alterações</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Editar Professor -->
    <div class="modal fade" id="modalEditarProfessor" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Editar Professor</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="formEditarProfessor" method="post" enctype="multipart/form-data">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editNomeProfessor" class="form-label">Nome Completo</label>
                                    <input type="text" class="form-control" id="editNomeProfessor" name="nome" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editEmailProfessor" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="editEmailProfessor" name="email" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editSenhaProfessor" class="form-label">Nova Senha (deixe em branco para manter a atual)</label>
                                    <input type="password" class="form-control" id="editSenhaProfessor" name="senha">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editCampusProfessor" class="form-label">Campus</label>
                                    <select class="form-select" id="editCampusProfessor" name="campus_id" required>
                                        <option value="">Selecione o campus</option>
                                        {% for campus in campus_list %}
                                        <option value="{{ campus.id }}">{{ campus.nome }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editImagemProfessor" class="form-label">Nova Foto</label>
                                    <input type="file" class="form-control" id="editImagemProfessor" name="imagem" accept="image/*">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="fecharModal('modalEditarProfessor')">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Salvar Alterações</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Editar Gestor -->
    <div class="modal fade" id="modalEditarGestor" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Editar Gestor</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="formEditarGestor" method="post" enctype="multipart/form-data">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editNomeGestor" class="form-label">Nome Completo</label>
                                    <input type="text" class="form-control" id="editNomeGestor" name="nome" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editEmailGestor" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="editEmailGestor" name="email" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editSenhaGestor" class="form-label">Nova Senha (deixe em branco para manter a atual)</label>
                                    <input type="password" class="form-control" id="editSenhaGestor" name="senha">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editImagemGestor" class="form-label">Nova Foto</label>
                                    <input type="file" class="form-control" id="editImagemGestor" name="imagem" accept="image/*">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="fecharModal('modalEditarGestor')">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Salvar Alterações</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"></script>
    <script src="/static/js/menu.js"></script>
    
    <script>
        // Inicializar abas do Bootstrap
        document.addEventListener('DOMContentLoaded', function() {
            // Garantir que as abas funcionem
            var triggerTabList = [].slice.call(document.querySelectorAll('#usuariosTabs button'))
            triggerTabList.forEach(function (triggerEl) {
                triggerEl.addEventListener('click', function (event) {
                    event.preventDefault()
                    var target = document.querySelector(triggerEl.getAttribute('data-bs-target'))
                    if (target) {
                        // Remover active de todas as abas
                        document.querySelectorAll('#usuariosTabs button').forEach(function(btn) {
                            btn.classList.remove('active')
                        })
                        document.querySelectorAll('.tab-pane').forEach(function(pane) {
                            pane.classList.remove('show', 'active')
                        })
                        
                        // Ativar aba clicada
                        triggerEl.classList.add('active')
                        target.classList.add('show', 'active')
                    }
                })
            });
        });

        // Funções de busca e filtro
        document.getElementById('buscarAlunos').addEventListener('input', function() {
            filtrarTabela('tabelaAlunos', this.value);
        });

        document.getElementById('buscarProfessores').addEventListener('input', function() {
            filtrarTabela('tabelaProfessores', this.value);
        });

        document.getElementById('buscarGestores').addEventListener('input', function() {
            filtrarTabela('tabelaGestores', this.value);
        });

        document.getElementById('buscarCampus').addEventListener('input', function() {
            filtrarTabela('tabelaCampus', this.value);
        });

        // Filtro por curso
        document.getElementById('filtroCursoAlunos').addEventListener('change', function() {
            filtrarPorCurso('tabelaAlunos', this.value);
        });

        function filtrarTabela(tabelaId, termo) {
            const tabela = document.getElementById(tabelaId);
            const linhas = tabela.getElementsByTagName('tr');
            
            for (let i = 0; i < linhas.length; i++) {
                const linha = linhas[i];
                const texto = linha.textContent.toLowerCase();
                if (texto.includes(termo.toLowerCase())) {
                    linha.style.display = '';
                } else {
                    linha.style.display = 'none';
                }
            }
        }

        function filtrarPorCurso(tabelaId, curso) {
            const tabela = document.getElementById(tabelaId);
            const linhas = tabela.getElementsByTagName('tr');
            
            for (let i = 0; i < linhas.length; i++) {
                const linha = linhas[i];
                const celulas = linha.getElementsByTagName('td');
                
                if (celulas.length > 0) {
                    const cursoLinha = celulas[3].textContent.trim(); // Curso está na 4ª coluna
                    
                    if (curso === '' || cursoLinha === curso) {
                        linha.style.display = '';
                    } else {
                        linha.style.display = 'none';
                    }
                }
            }
        }

        // Funções de ação
        function verDetalhesAluno(id) {
            window.location.href = '/alunos/' + id;
        }

        function editarAluno(id) {
            // Buscar dados do aluno na tabela
            const tabela = document.getElementById('tabelaAlunos');
            const linhas = tabela.getElementsByTagName('tr');
            
            for (let i = 0; i < linhas.length; i++) {
                const linha = linhas[i];
                const botaoEditar = linha.querySelector('button[onclick*="editarAluno(' + id + ')"]');
                if (botaoEditar) {
                    // Extrair dados da linha
                    const celulas = linha.getElementsByTagName('td');
                    const nome = celulas[1].textContent.trim();
                    const email = celulas[2].textContent.trim();
                    const curso = celulas[3].textContent.trim();
                    const ano = celulas[4].textContent.trim();
                    
                    // Preencher o modal
                    document.getElementById('editNomeAluno').value = nome;
                    document.getElementById('editEmailAluno').value = email;
                    document.getElementById('editCursoAluno').value = curso;
                    document.getElementById('editAnoAluno').value = ano;
                    
                    // Configurar action do formulário
                    document.getElementById('formEditarAluno').action = '/gestor/editar-aluno/' + id;
                    
                    // Abrir modal
                    if (typeof bootstrap !== 'undefined') {
                        const modal = new bootstrap.Modal(document.getElementById('modalEditarAluno'));
                        modal.show();
                    } else {
                        // Fallback: mostrar modal manualmente
                        document.getElementById('modalEditarAluno').style.display = 'block';
                        document.getElementById('modalEditarAluno').classList.add('show');
                        document.body.classList.add('modal-open');
                    }
                    break;
                }
            }
        }

        function excluirAluno(id, nome) {
            if (confirm('Tem certeza que deseja excluir o aluno "' + nome + '"?')) {
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '/gestor/excluir-aluno/' + id;
                document.body.appendChild(form);
                form.submit();
            }
        }

        function verDetalhesProfessor(id) {
            window.location.href = '/gestor/professor/' + id + '/detalhes';
        }

        function editarProfessor(id) {
            // Buscar dados do professor na tabela
            const tabela = document.getElementById('tabelaProfessores');
            const linhas = tabela.getElementsByTagName('tr');
            
            for (let i = 0; i < linhas.length; i++) {
                const linha = linhas[i];
                const botaoEditar = linha.querySelector('button[onclick*="editarProfessor(' + id + ')"]');
                if (botaoEditar) {
                    // Extrair dados da linha
                    const celulas = linha.getElementsByTagName('td');
                    const nome = celulas[1].textContent.trim();
                    const email = celulas[2].textContent.trim();
                    const campus = celulas[3].textContent.trim();
                    
                    // Preencher o modal
                    document.getElementById('editNomeProfessor').value = nome;
                    document.getElementById('editEmailProfessor').value = email;
                    
                    // Encontrar o campus correto no select
                    const campusSelect = document.getElementById('editCampusProfessor');
                    for (let j = 0; j < campusSelect.options.length; j++) {
                        if (campusSelect.options[j].text === campus) {
                            campusSelect.selectedIndex = j;
                            break;
                        }
                    }
                    
                    // Configurar action do formulário
                    document.getElementById('formEditarProfessor').action = '/gestor/editar-professor/' + id;
                    
                    // Abrir modal
                    if (typeof bootstrap !== 'undefined') {
                        const modal = new bootstrap.Modal(document.getElementById('modalEditarProfessor'));
                        modal.show();
                    } else {
                        document.getElementById('modalEditarProfessor').style.display = 'block';
                        document.getElementById('modalEditarProfessor').classList.add('show');
                        document.body.classList.add('modal-open');
                    }
                    break;
                }
            }
        }

        function excluirProfessor(id, nome) {
            if (confirm('Tem certeza que deseja excluir o professor "' + nome + '"?')) {
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '/gestor/excluir-professor/' + id;
                document.body.appendChild(form);
                form.submit();
            }
        }

        function verDetalhesGestor(id) {
            window.location.href = '/gestor/gestor/' + id + '/detalhes';
        }

        function editarGestor(id) {
            // Buscar dados do gestor na tabela
            const tabela = document.getElementById('tabelaGestores');
            const linhas = tabela.getElementsByTagName('tr');
            
            for (let i = 0; i < linhas.length; i++) {
                const linha = linhas[i];
                const botaoEditar = linha.querySelector('button[onclick*="editarGestor(' + id + ')"]');
                if (botaoEditar) {
                    // Extrair dados da linha
                    const celulas = linha.getElementsByTagName('td');
                    const nome = celulas[1].textContent.trim();
                    const email = celulas[2].textContent.trim();
                    
                    // Preencher o modal
                    document.getElementById('editNomeGestor').value = nome;
                    document.getElementById('editEmailGestor').value = email;
                    
                    // Configurar action do formulário
                    document.getElementById('formEditarGestor').action = '/gestor/editar-gestor/' + id;
                    
                    // Abrir modal
                    if (typeof bootstrap !== 'undefined') {
                        const modal = new bootstrap.Modal(document.getElementById('modalEditarGestor'));
                        modal.show();
                    } else {
                        document.getElementById('modalEditarGestor').style.display = 'block';
                        document.getElementById('modalEditarGestor').classList.add('show');
                        document.body.classList.add('modal-open');
                    }
                    break;
                }
            }
        }

        function excluirGestor(id, nome) {
            if (confirm('Tem certeza que deseja excluir o gestor "' + nome + '"?')) {
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '/gestor/excluir-gestor/' + id;
                document.body.appendChild(form);
                form.submit();
            }
        }

        // Funções para gerenciar campus
        function editarCampus(id, nome, endereco, ativo) {
            document.getElementById('editNomeCampus').value = nome;
            document.getElementById('editEnderecoCampus').value = endereco;
            document.getElementById('editAtivoCampus').checked = ativo;
            
            document.getElementById('formEditarCampus').action = '/gestor/editar-campus/' + id;
            
            // Verificar se Bootstrap está carregado
            if (typeof bootstrap !== 'undefined') {
                const modal = new bootstrap.Modal(document.getElementById('modalEditarCampus'));
                modal.show();
            } else {
                // Fallback: mostrar modal manualmente
                document.getElementById('modalEditarCampus').style.display = 'block';
                document.getElementById('modalEditarCampus').classList.add('show');
                document.body.classList.add('modal-open');
            }
        }

        function excluirCampus(id, nome) {
            if (confirm('Tem certeza que deseja excluir o campus "' + nome + '"?')) {
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '/gestor/excluir-campus/' + id;
                document.body.appendChild(form);
                form.submit();
            }
        }

        // Funções para abrir e fechar modais
        function abrirModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                if (typeof bootstrap !== 'undefined') {
                    const modalInstance = new bootstrap.Modal(modal);
                    modalInstance.show();
                } else {
                    // Fallback: mostrar modal manualmente
                    modal.style.display = 'block';
                    modal.classList.add('show');
                    document.body.classList.add('modal-open');
                }
            }
        }

        function fecharModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                if (typeof bootstrap !== 'undefined') {
                    const modalInstance = bootstrap.Modal.getInstance(modal);
                    if (modalInstance) {
                        modalInstance.hide();
                    }
                } else {
                    // Fallback: fechar modal manualmente
                    modal.style.display = 'none';
                    modal.classList.remove('show');
                    document.body.classList.remove('modal-open');
                }
            }
        }

        // Adicionar event listeners para fechar modais
        document.addEventListener('DOMContentLoaded', function() {
            // Fechar modais ao clicar no X
            document.querySelectorAll('.btn-close').forEach(function(btn) {
                btn.addEventListener('click', function() {
                    const modal = this.closest('.modal');
                    if (modal) {
                        fecharModal(modal.id);
                    }
                });
            });

            // Fechar modais ao clicar fora
            document.querySelectorAll('.modal').forEach(function(modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        fecharModal(this.id);
                    }
                });
            });
        });
    </script>
</body>

</html>
